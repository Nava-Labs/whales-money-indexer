type ProtocolOverview @entity(immutable: false) {
  id: ID! # BONDLINK
  totalVolume: BigInt! # Total USDC converted to USDB
  totalVolumeSUSDB: BigInt! # Total USDB staked in sUSDB
  totalYieldDistributed: BigInt! # Total yield distributed
  totalOngoingRedeemUSDB: BigInt! # Total ongoing redeem USDB
  usdbToUsdcRedeemLogs: [RedeemLogs!]
  users: [User!] @derivedFrom(field: "protocolOverview")
}

type RedeemLogs @entity(immutable: false) {
  id: ID! # TX HASH
  user: User!
  amount: BigInt!
  claimableDate: BigInt!
}

type User @entity(immutable: false) {
  id: ID! # Address
  totalVolume: BigInt! #TotalVolumeUSDB
  totalVolumeSUSDB: BigInt! #TotalVolumeSUSDB
  redeemAmount: BigInt!
  protocolOverview: ProtocolOverview!
  isWhitelisted: Boolean!
  userInPoint: [UserInPoint!] @derivedFrom(field: "user")
  activity: [UserActivity!] @derivedFrom(field: "user")
}

# Bridge user & po
type UserInPoint @entity(immutable: false) {
  id: ID! #defi - user
  totalPointEarned: BigInt!
  stakeAmount: BigInt!
  stakeTimestamp: BigInt!
  endStakeTimestamp: BigInt!
  status: String!

  user: User!
  pointRules: PointRules!
}

type PointRules @entity(immutable: false) {
  id: ID! #defi address
  name: String!
  tag: String!
  minTransferAmount: BigInt!
  maxPoint: BigInt!
  basePointTx: BigInt!
  maxPointTx: BigInt!
  startTimestamp: BigInt!
  endTimestamp: BigInt!
  types: String!
  userInPoint: [UserInPoint!] @derivedFrom(field: "pointRules")
}

type DefiIntegration @entity(immutable: false) {
  id: ID! # pendle uniswap tag
  totalVolume: BigInt!
  txCount: BigInt!
  activities: [UserActivity!] @derivedFrom(field: "defi")
}

enum ActivityType {
  DEPOSIT_USDB
  CDREDEEM_USDB
  REDEEM_USDB
  STAKED_USDB
  TRANSFER_USDB
  TRANSFER_SUSDB
  STAKE_USDB_DEFI
  UNSTAKE_USDB_DEFI
  STAKE_SUSDB_DEFI
  UNSTAKE_SUSDB_DEFI
}

type UserActivity @entity(immutable: false) {
  id: ID! #tx hash
  type: ActivityType! # Type of activity
  amount: BigInt!
  timestamp: BigInt!
  user: User!
  defi: DefiIntegration
}
