type ProtocolOverview @entity(immutable: false) {
  id: ID! # BONDLINK
  totalVolumeUSDB: BigInt! # Total USDC converted to USDB , decimal 6
  totalVolumeSUSDB: BigInt! # Total USDB staked in sUSDB
  totalYieldDistributed: BigInt! # Total yield distributed
  totalOngoingRedeemUSDB: BigInt! # Total ongoing redeem USDB
  user: [User!] @derivedFrom(field: "protocolOverview")
  userInRedeem: [UserInRedeem!] @derivedFrom(field: "protocolOverview")
}

type UserInRedeem @entity(immutable: false) {
  id: ID! # user - redeem
  amountInUsdb: BigInt!
  claimableTimestamp: BigInt!
  status: String!
  user: User!
  protocolOverview: ProtocolOverview!
}

type User @entity(immutable: false) {
  id: ID! # Address
  totalVolumeUSDB: BigInt! #TotalVolumeUSDB
  totalVolumeSUSDB: BigInt! #TotalVolumeSUSDB
  balanceUSDB: BigInt!
  balanceSUSDB: BigInt!
  redeemAmountInUSDC: BigInt!
  realizedYieldAmountInUSDB: BigInt!
  protocolOverview: ProtocolOverview!
  isBoosted: Boolean!
  userInPoint: [UserInPoint!] @derivedFrom(field: "user")
  activity: [UserActivity!] @derivedFrom(field: "user")
  userInRdeem: UserInRedeem! @derivedFrom(field: "user")
}

# Bridge user & po
type UserInPoint @entity(immutable: false) {
  id: ID! #defi - user
  totalPointEarned: BigDecimal!
  stakeAmount: BigInt!
  lastStakeTimestamp: BigInt!
  lastMultipliers: BigDecimal!
  status: String!
  user: User!
  pointRule: PointRule!
}

type PointRule @entity(immutable: false) {
  id: ID! #defi address
  name: String!
  tag: String!
  iconUrl: String!
  actionUrl: String!
  origin: String!
  address: String!
  minTransferAmount: BigInt!
  maxPoint: BigDecimal!
  basePoint: BigDecimal!
  startTimestamp: BigDecimal!
  endTimestamp: BigDecimal!
  types: String!
  userInPoint: [UserInPoint!] @derivedFrom(field: "pointRule")
  multiplier: [Multiplier!] @derivedFrom(field: "pointRule")
}

type Multiplier @entity(immutable: false) {
  id: ID! #defi address - multiplier[i]
  multiplier: BigDecimal!
  minThresholdMultiplier: BigInt!
  pointRule: PointRule!
}

type DefiIntegration @entity(immutable: false) {
  id: ID! # pendle uniswap tag
  balanceUSDB: BigInt!
  balanceSUSDB: BigInt!
  totalVolumeUSDB: BigInt!
  txCount: BigInt!
  userActivity: [UserActivity!] @derivedFrom(field: "defiIntegration")
}

enum ActivityType {
  DEPOSIT_USDB
  CDREDEEM_USDB
  REDEEM_USDB
  STAKE_USDB
  CDREDEEM_SUSDB
  UNSTAKE_USDB
  TRANSFER_USDB
  TRANSFER_SUSDB
  STAKE_USDB_DEFI
  UNSTAKE_USDB_DEFI
  STAKE_SUSDB_DEFI
  UNSTAKE_SUSDB_DEFI
  STAKE_LP_DEFI
  UNSTAKE_LP_DEFI
}

enum OriginActivityType {
  USDB
  SUSDB
}

type UserActivity @entity(immutable: false) {
  id: ID! #tx hash
  activityType: ActivityType! # Type of activity
  amount: BigInt!
  timestamp: BigInt!
  originType: OriginActivityType!
  user: User!
  defiIntegration: DefiIntegration
}

type TransferLog @entity(immutable: false) {
  id: ID! #tx hash
  from: String!
  to: String!
  amount: BigInt!
  timestamp: BigInt!
  origin: String!
  isValuable: Boolean!
}
